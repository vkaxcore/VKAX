name: "Cache wrapper"

description: "Thin wrapper around actions/cache@v4 to accept 'paths' input (newline-separated) and forward to 'path' expected by actions/cache. Adds diagnostics and guards when no paths are provided."

inputs:
  key:
    description: 'Cache key'
    required: true
  paths:
    description: 'Newline-separated paths to cache (maps to actions/cache path).'
    required: false
  restore-keys:
    description: 'Restore keys (newline-separated)'
    required: false
  upload-chunk-size:
    description: 'Optional upload chunk size'
    required: false
  enableCrossOsArchive:
    description: 'Optional pass-through (boolean)'
    required: false
  fail-on-cache-miss:
    description: 'Optional pass-through (boolean)'
    required: false
  lookup-only:
    description: 'Optional pass-through (boolean)'
    required: false
  save-always:
    description: 'Optional pass-through (boolean)'
    required: false

runs:
  using: composite
  steps:
    - name: Echo cache inputs
      shell: bash
      run: |
        echo "Cache wrapper — key: ${{ inputs.key }}"
        echo "Paths: '${{ inputs['paths'] }}'"
        echo "Restore keys: '${{ inputs['restore-keys'] }}'"
        echo "upload-chunk-size: '${{ inputs['upload-chunk-size'] }}'"
        echo "enableCrossOsArchive: '${{ inputs['enableCrossOsArchive'] }}'"
        echo "fail-on-cache-miss: '${{ inputs['fail-on-cache-miss'] }}'"
        echo "lookup-only: '${{ inputs['lookup-only'] }}'"
        echo "save-always: '${{ inputs['save-always'] }}'"

    - name: Skip cache when no paths provided
      if: ${{ inputs['paths'] == '' || inputs['paths'] == null }}
      shell: bash
      run: |
        echo "No paths provided to cache — skipping actions/cache"

    - name: Run actions/cache@v4
      if: ${{ inputs['paths'] != '' && inputs['paths'] != null }}
      uses: actions/cache@v4
      with:
        key: ${{ inputs.key }}
        path: ${{ inputs['paths'] }}
        restore-keys: ${{ inputs['restore-keys'] }}
        upload-chunk-size: ${{ inputs['upload-chunk-size'] }}
        enableCrossOsArchive: ${{ inputs['enableCrossOsArchive'] }}
        fail-on-cache-miss: ${{ inputs['fail-on-cache-miss'] }}
        lookup-only: ${{ inputs['lookup-only'] }}
        save-always: ${{ inputs['save-always'] }}
